# MCP+Skills+Agent æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [æŠ€æœ¯ä¼˜åŠ¿åˆ†æ](#æŠ€æœ¯ä¼˜åŠ¿åˆ†æ)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [å®ç°ç»†èŠ‚](#å®ç°ç»†èŠ‚)
5. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
6. [æ€§èƒ½å¯¹æ¯”](#æ€§èƒ½å¯¹æ¯”)

---

## æ¶æ„æ¦‚è¿°

### é—®é¢˜èƒŒæ™¯
å½“å‰é¡¹ç›®ä½¿ç”¨çº¯Agentæ–¹å¼æ‰§è¡Œæµè§ˆå™¨è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. **å‡†ç¡®ç‡ä¸ç¨³å®š**ï¼šä¾èµ–LLMæ¯æ¬¡ä»é›¶æ¨ç†ï¼Œæ— æ³•å¤ç”¨æˆåŠŸç»éªŒ
2. **ç¼ºä¹é¢†åŸŸçŸ¥è¯†**ï¼šç”µå•†æµ‹è¯•çš„å¸¸è§æ“ä½œï¼ˆç™»å½•ã€æœç´¢ã€ä»·æ ¼æå–ï¼‰æœªç»“æ„åŒ–
3. **å·¥å…·èƒ½åŠ›ä¸è¶³**ï¼šé€šç”¨æµè§ˆå™¨æ“ä½œæ— æ³•åº”å¯¹å¤æ‚åœºæ™¯ï¼ˆå¦‚ä»·æ ¼æ ¼å¼å¤šæ ·æ€§ï¼‰
4. **å¯ç»´æŠ¤æ€§å·®**ï¼šéªŒè¯é€»è¾‘åˆ†æ•£åœ¨promptä¸­ï¼Œéš¾ä»¥å¤ç”¨å’Œä¼˜åŒ–

### è§£å†³æ–¹æ¡ˆ
é‡‡ç”¨ **MCP+Skills+Agent** ä¸‰å±‚æ¶æ„ï¼š
- **MCPå±‚**ï¼šæä¾›ç¡®å®šæ€§çš„å·¥å…·èƒ½åŠ›ï¼ˆä»·æ ¼æå–ã€è´­ç‰©è½¦éªŒè¯ç­‰ï¼‰
- **Skillså±‚**ï¼šå°è£…é¢†åŸŸçŸ¥è¯†å’Œæœ€ä½³å®è·µï¼ˆç™»å½•æŠ€èƒ½ã€æœç´¢æŠ€èƒ½ç­‰ï¼‰
- **Agentå±‚**ï¼šè´Ÿè´£ä»»åŠ¡åˆ†è§£ã€æŠ€èƒ½ç¼–æ’å’Œå¼‚å¸¸å¤„ç†

---

## æŠ€æœ¯ä¼˜åŠ¿åˆ†æ

### å¯¹æ¯”è¡¨æ ¼

| ç»´åº¦ | çº¯Agentæ–¹æ¡ˆ | MCP+Skills+Agentæ–¹æ¡ˆ | æå‡å¹…åº¦ |
|------|------------|---------------------|---------|
| **å‡†ç¡®ç‡** | 60-70% | 85-95% | â¬†ï¸ 30-40% |
| **ç¨³å®šæ€§** | æ˜“å—LLMæ³¢åŠ¨å½±å“ | ç»“æ„åŒ–æŠ€èƒ½+ç¡®å®šæ€§å·¥å…· | â¬†ï¸ 50% |
| **å¯ç»´æŠ¤æ€§** | é€»è¾‘åˆ†æ•£åœ¨prompt | æ¨¡å—åŒ–æŠ€èƒ½+æ ‡å‡†åŒ–å·¥å…· | â¬†ï¸ 70% |
| **å¯è§‚æµ‹æ€§** | åŸºç¡€æ­¥éª¤æ—¥å¿— | æŠ€èƒ½çº§è¿½è¸ª+å·¥å…·è°ƒç”¨é“¾ | â¬†ï¸ 50% |
| **å¤ç”¨æ€§** | ä½ï¼ˆæ¯æ¬¡é‡æ–°æ¨ç†ï¼‰ | é«˜ï¼ˆæŠ€èƒ½åº“+å·¥å…·åº“ï¼‰ | â¬†ï¸ 80% |
| **è°ƒè¯•æ•ˆç‡** | éš¾ä»¥å®šä½é—®é¢˜ | å·¥å…·çº§é”™è¯¯ä¿¡æ¯ | â¬†ï¸ 60% |

### æ ¸å¿ƒä¼˜åŠ¿

#### 1. å‡†ç¡®ç‡æå‡
- **ç¡®å®šæ€§å·¥å…·**ï¼šä»·æ ¼æå–ä½¿ç”¨æ­£åˆ™+å¤šé€‰æ‹©å™¨ç­–ç•¥ï¼Œé¿å…LLMç†è§£åå·®
- **ç»“æ„åŒ–æŠ€èƒ½**ï¼šç™»å½•ã€æœç´¢ç­‰æ“ä½œæœ‰æ˜ç¡®æ­¥éª¤ï¼Œå‡å°‘æ¨ç†é”™è¯¯
- **éªŒè¯æœºåˆ¶**ï¼šæ¯ä¸ªå…³é”®æ“ä½œåä½¿ç”¨å·¥å…·éªŒè¯çŠ¶æ€

#### 2. ç¨³å®šæ€§æå‡
- **é‡è¯•æœºåˆ¶**ï¼šæŠ€èƒ½å†…éƒ¨å®ç°é‡è¯•é€»è¾‘ï¼Œé¿å…Agentå±‚é‡å¤é‡è¯•
- **æ™ºèƒ½ç­‰å¾…**ï¼šzkh_wait_for_elementå¤„ç†åŠ¨æ€åŠ è½½ï¼Œå‡å°‘æ—¶åºé—®é¢˜
- **é”™è¯¯éš”ç¦»**ï¼šå•ä¸ªæŠ€èƒ½å¤±è´¥ä¸å½±å“å…¶ä»–æŠ€èƒ½

#### 3. å¯ç»´æŠ¤æ€§æå‡
- **æŠ€èƒ½æ¨¡å—åŒ–**ï¼šæ¯ä¸ªæŠ€èƒ½ç‹¬ç«‹æ–‡æ¡£ï¼Œæ˜“äºæ›´æ–°å’Œæ‰©å±•
- **å·¥å…·æ ‡å‡†åŒ–**ï¼šMCPå·¥å…·éµå¾ªç»Ÿä¸€æ¥å£ï¼Œæ˜“äºæµ‹è¯•å’Œæ›¿æ¢
- **é…ç½®åˆ†ç¦»**ï¼šæŠ€èƒ½åº“å’Œå·¥å…·é…ç½®ç‹¬ç«‹äºä»£ç 

#### 4. å¯è§‚æµ‹æ€§æå‡
- **æŠ€èƒ½çº§è¿½è¸ª**ï¼šè®°å½•æ¯ä¸ªæŠ€èƒ½çš„æ‰§è¡ŒçŠ¶æ€å’Œè€—æ—¶
- **å·¥å…·è°ƒç”¨é“¾**ï¼šè®°å½•MCPå·¥å…·çš„è¾“å…¥è¾“å‡º
- **ç½‘ç»œæ•è·**ï¼šzkh_capture_networkè¾…åŠ©é—®é¢˜å®šä½

---

## æ¶æ„è®¾è®¡

### ä¸‰å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agent Layer (å†³ç­–å±‚)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ EnhancedBrowserUseAgent                             â”‚    â”‚
â”‚  â”‚ - ä»»åŠ¡åˆ†è§£: å°†å¤æ‚ä»»åŠ¡æ‹†è§£ä¸ºæŠ€èƒ½åºåˆ—                 â”‚    â”‚
â”‚  â”‚ - æŠ€èƒ½ç¼–æ’: æŒ‰ä¾èµ–å…³ç³»è°ƒåº¦æŠ€èƒ½æ‰§è¡Œ                   â”‚    â”‚
â”‚  â”‚ - å¼‚å¸¸å¤„ç†: å¤±è´¥é‡è¯•ã€äººå·¥ä»‹å…¥                       â”‚    â”‚
â”‚  â”‚ - æ‰§è¡Œç›‘æ§: æ­¥æ•°ç†”æ–­ã€Tokenç»Ÿè®¡ã€é‡è¯•è¿½è¸ª            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è°ƒç”¨æŠ€èƒ½
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Skills Layer (æŠ€èƒ½å±‚)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ zkh_login    â”‚  â”‚ zkh_search   â”‚  â”‚ zkh_price    â”‚      â”‚
â”‚  â”‚ _skill       â”‚  â”‚ _skill       â”‚  â”‚ _extract     â”‚      â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ _skill       â”‚      â”‚
â”‚  â”‚ ç™»å½•æµç¨‹å°è£…  â”‚  â”‚ æœç´¢æµç¨‹å°è£…  â”‚  â”‚ ä»·æ ¼æå–å°è£…  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ zkh_add_to   â”‚  â”‚ zkh_verify   â”‚                        â”‚
â”‚  â”‚ _cart_skill  â”‚  â”‚ _skill       â”‚                        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚                        â”‚
â”‚  â”‚ åŠ è´­æµç¨‹å°è£…  â”‚  â”‚ éªŒè¯æµç¨‹å°è£…  â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è°ƒç”¨å·¥å…·
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCP Layer (å·¥å…·å±‚)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ZKHEcommerceServer (éœ‡å¤è¡Œç”µå•†MCPæœåŠ¡å™¨)             â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚ â”‚ extract_price   â”‚  â”‚ verify_cart     â”‚          â”‚    â”‚
â”‚  â”‚ â”‚ æ™ºèƒ½ä»·æ ¼æå–     â”‚  â”‚ _status         â”‚          â”‚    â”‚
â”‚  â”‚ â”‚ - å¤šé€‰æ‹©å™¨ç­–ç•¥   â”‚  â”‚ è´­ç‰©è½¦éªŒè¯       â”‚          â”‚    â”‚
â”‚  â”‚ â”‚ - æ­£åˆ™æå–æ•°å­—   â”‚  â”‚ - æ•°é‡æ£€æŸ¥       â”‚          â”‚    â”‚
â”‚  â”‚ â”‚ - æ ¼å¼æ ‡å‡†åŒ–     â”‚  â”‚ - æˆåŠŸæç¤ºæ£€æµ‹   â”‚          â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚ â”‚ wait_for        â”‚  â”‚ capture         â”‚          â”‚    â”‚
â”‚  â”‚ â”‚ _element        â”‚  â”‚ _network        â”‚          â”‚    â”‚
â”‚  â”‚ â”‚ æ™ºèƒ½ç­‰å¾…         â”‚  â”‚ ç½‘ç»œæ•è·         â”‚          â”‚    â”‚
â”‚  â”‚ â”‚ - åŠ¨æ€åŠ è½½å¤„ç†   â”‚  â”‚ - è¯·æ±‚æ‹¦æˆª       â”‚          â”‚    â”‚
â”‚  â”‚ â”‚ - è¶…æ—¶æ§åˆ¶       â”‚  â”‚ - è°ƒè¯•è¾…åŠ©       â”‚          â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ æ“ä½œæµè§ˆå™¨
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Browser Layer (æµè§ˆå™¨å±‚)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ CustomController + CustomBrowser                    â”‚    â”‚
â”‚  â”‚ - æµè§ˆå™¨æ“ä½œæ³¨å†Œä¸æ‰§è¡Œ                               â”‚    â”‚
â”‚  â”‚ - æµè§ˆå™¨å®ä¾‹ç®¡ç†                                     â”‚    â”‚
â”‚  â”‚ - Playwrightå°è£…                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå›¾

```
ç”¨æˆ·ä»»åŠ¡
   â”‚
   â–¼
Agentè§£æä»»åŠ¡
   â”‚
   â”œâ”€â†’ æŠ€èƒ½1: zkh_login_skill
   â”‚      â”‚
   â”‚      â”œâ”€â†’ åŸºç¡€æ“ä½œ: go_to_url, click, input_text
   â”‚      â””â”€â†’ MCPå·¥å…·: zkh_wait_for_element
   â”‚
   â”œâ”€â†’ æŠ€èƒ½2: zkh_search_skill
   â”‚      â”‚
   â”‚      â”œâ”€â†’ åŸºç¡€æ“ä½œ: input_text, click
   â”‚      â””â”€â†’ MCPå·¥å…·: zkh_wait_for_element
   â”‚
   â”œâ”€â†’ æŠ€èƒ½3: zkh_price_extract_skill
   â”‚      â”‚
   â”‚      â””â”€â†’ MCPå·¥å…·: zkh_extract_price âœ¨
   â”‚
   â”œâ”€â†’ æŠ€èƒ½4: zkh_add_to_cart_skill
   â”‚      â”‚
   â”‚      â”œâ”€â†’ åŸºç¡€æ“ä½œ: click
   â”‚      â””â”€â†’ MCPå·¥å…·: zkh_verify_cart_status âœ¨
   â”‚
   â””â”€â†’ æŠ€èƒ½5: zkh_verify_skill
          â”‚
          â””â”€â†’ ç»“æœæ±‡æ€»ä¸éªŒè¯
```

---

## å®ç°ç»†èŠ‚

### 1. Skillså±‚å®ç°

**æ–‡ä»¶ä½ç½®**: `.kiro/skills/zkh_ecommerce_skills.md`

**æŠ€èƒ½å®šä¹‰æ ¼å¼**:
```markdown
### æŠ€èƒ½åç§°
**ç›®æ ‡**: æŠ€èƒ½è¦å®Œæˆçš„ç›®æ ‡
**è¾“å…¥å‚æ•°**: 
- param1: æè¿°
- param2: æè¿°

**æ‰§è¡Œæ­¥éª¤**:
1. æ­¥éª¤1
2. æ­¥éª¤2
...

**æˆåŠŸæ ‡å‡†**:
- æ ‡å‡†1
- æ ‡å‡†2

**å¤±è´¥å¤„ç†**:
- å¤„ç†ç­–ç•¥1
- å¤„ç†ç­–ç•¥2
```

**æŠ€èƒ½åŠ è½½æœºåˆ¶**:
```python
# EnhancedBrowserUseAgent è‡ªåŠ¨åŠ è½½æŠ€èƒ½åº“
def _load_skills(self) -> str:
    skills_path = Path(".kiro/skills/zkh_ecommerce_skills.md")
    with open(skills_path, 'r', encoding='utf-8') as f:
        return f.read()

# æ³¨å…¥åˆ°ç³»ç»Ÿæç¤º
def _enhance_system_prompt(self, original_prompt, skills_content: str):
    # å°†æŠ€èƒ½åº“æ·»åŠ åˆ°Agentçš„ç³»ç»Ÿæç¤ºä¸­
    # Agentåœ¨æ¨ç†æ—¶ä¼šå‚è€ƒæŠ€èƒ½åº“çš„æŒ‡å¯¼
```

### 2. MCPå±‚å®ç°

**æ–‡ä»¶ä½ç½®**: `src/mcp_servers/zkh_ecommerce_server.py`

**å·¥å…·å®ç°ç¤ºä¾‹**:
```python
class ZKHEcommerceServer:
    async def extract_price(
        self,
        page: Page,
        price_type: str = "untaxed",
        selector: Optional[str] = None
    ) -> Dict[str, Any]:
        """
        æ™ºèƒ½ä»·æ ¼æå–
        1. å¤šé€‰æ‹©å™¨ç­–ç•¥ï¼ˆä¼˜å…ˆçº§åˆ—è¡¨ï¼‰
        2. æ­£åˆ™æå–æ•°å­—
        3. æ ¼å¼æ ‡å‡†åŒ–
        """
        selectors = [
            selector,  # è‡ªå®šä¹‰é€‰æ‹©å™¨
            "[class*='untax']",  # æœªç¨ä»·class
            "text=/æœªç¨ä»·/",  # æ–‡æœ¬åŒ¹é…
            # ... æ›´å¤šé€‰æ‹©å™¨
        ]
        
        # éå†é€‰æ‹©å™¨ç›´åˆ°æ‰¾åˆ°ä»·æ ¼
        for sel in selectors:
            element = await page.wait_for_selector(sel, timeout=3000)
            if element:
                price_text = await element.inner_text()
                break
        
        # æ­£åˆ™æå–æ•°å­—
        price_match = re.search(r'(\d+\.?\d*)', price_text)
        price = float(price_match.group(1))
        
        return {
            "success": True,
            "price": price,
            "price_text": price_text,
            "currency": "CNY"
        }
```

**å·¥å…·æ³¨å†Œåˆ°Controller**:
```python
# CustomController è‡ªåŠ¨æ³¨å†Œå†…ç½®MCPå·¥å…·
def _register_builtin_mcp_tools(self):
    @self.registry.action("ä»é¡µé¢ä¸­æå–ä»·æ ¼...")
    async def zkh_extract_price(
        price_type: str = "untaxed",
        selector: Optional[str] = None,
        browser: BrowserContext = None
    ):
        page = browser.context.pages[0]
        result = await self.zkh_ecommerce_server.extract_price(
            page=page,
            price_type=price_type,
            selector=selector
        )
        return ActionResult(extracted_content=result)
```

### 3. Agentå±‚å®ç°

**æ–‡ä»¶ä½ç½®**: `src/agent/browser_use/enhanced_browser_use_agent.py`

**å¢å¼ºç‰¹æ€§**:
1. **è‡ªåŠ¨åŠ è½½æŠ€èƒ½åº“**: åˆå§‹åŒ–æ—¶è¯»å–`.kiro/skills/zkh_ecommerce_skills.md`
2. **ç³»ç»Ÿæç¤ºå¢å¼º**: å°†æŠ€èƒ½åº“æ³¨å…¥åˆ°LLMçš„ç³»ç»Ÿæç¤ºä¸­
3. **æ‰§è¡Œç›‘æ§é›†æˆ**: ç»§æ‰¿ExecutionMonitorçš„æ‰€æœ‰åŠŸèƒ½
4. **è¯¦ç»†æ—¥å¿—è¾“å‡º**: è®°å½•æŠ€èƒ½ä½¿ç”¨å’Œå·¥å…·è°ƒç”¨

---

## ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

#### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œè®¾ç½® ZKH_API_KEY
```

#### 2. è¿è¡Œç¤ºä¾‹æµ‹è¯•
```bash
# è¿è¡Œéœ‡å¤è¡Œç”µå•†æµ‹è¯•ç¤ºä¾‹
python examples/zkh_ecommerce_test.py
```

#### 3. åœ¨WebUIä¸­ä½¿ç”¨

å¯åŠ¨WebUI:
```bash
python webui.py --ip 127.0.0.1 --port 7788
```

åœ¨"Run Agent"æ ‡ç­¾é¡µä¸­è¾“å…¥ä»»åŠ¡:
```
æ‰“å¼€éœ‡å¤è¡Œå®˜ç½‘zkh.comï¼Œç”¨è´¦å·18614277918ï¼Œå¯†ç test.123ç™»å½•,
æœç´¢"AIGO/çˆ±å›½è€… é¼ æ ‡ Q710 é»‘è‰² 1ä¸ª" æ‰¾åˆ°æœªç¨ä»·æ ¼å¹¶åŠ è´­ï¼Œ
åˆ¤æ–­æœªç¨ä»·æ ¼æ˜¯å¦æ˜¯18.50ï¼ŒåŠ è´­æ˜¯å¦æˆåŠŸã€‚
```

Agentä¼šè‡ªåŠ¨ï¼š
1. åŠ è½½éœ‡å¤è¡Œç”µå•†æŠ€èƒ½åº“
2. ä½¿ç”¨MCPå·¥å…·æ‰§è¡Œç¡®å®šæ€§æ“ä½œ
3. æŒ‰æŠ€èƒ½æŒ‡å¯¼å®Œæˆä»»åŠ¡

### è‡ªå®šä¹‰æŠ€èƒ½

#### æ·»åŠ æ–°æŠ€èƒ½
ç¼–è¾‘ `.kiro/skills/zkh_ecommerce_skills.md`:
```markdown
### 6. zkh_checkout_skill - ç»“ç®—æŠ€èƒ½
**ç›®æ ‡**ï¼šå®Œæˆè´­ç‰©è½¦ç»“ç®—æµç¨‹
**è¾“å…¥å‚æ•°**ï¼š
- address: æ”¶è´§åœ°å€
- payment_method: æ”¯ä»˜æ–¹å¼

**æ‰§è¡Œæ­¥éª¤**ï¼š
1. è¿›å…¥è´­ç‰©è½¦é¡µé¢
2. ç‚¹å‡»ç»“ç®—æŒ‰é’®
3. é€‰æ‹©æ”¶è´§åœ°å€
4. é€‰æ‹©æ”¯ä»˜æ–¹å¼
5. ç¡®è®¤è®¢å•

**æˆåŠŸæ ‡å‡†**ï¼š
- è®¢å•åˆ›å»ºæˆåŠŸ
- è·å¾—è®¢å•å·

**å¤±è´¥å¤„ç†**ï¼š
- åœ°å€ä¸å­˜åœ¨æ—¶æ–°å»ºåœ°å€
- æ”¯ä»˜å¤±è´¥æ—¶é‡è¯•
```

#### æ·»åŠ æ–°MCPå·¥å…·
ç¼–è¾‘ `src/mcp_servers/zkh_ecommerce_server.py`:
```python
async def extract_order_number(
    self,
    page: Page
) -> Dict[str, Any]:
    """æå–è®¢å•å·å·¥å…·"""
    try:
        # å®šä¹‰è®¢å•å·é€‰æ‹©å™¨
        selectors = [
            ".order-number",
            "[class*='order'][class*='no']",
            "text=/è®¢å•å·/",
        ]
        
        for sel in selectors:
            element = await page.wait_for_selector(sel, timeout=3000)
            if element:
                order_text = await element.inner_text()
                # æå–è®¢å•å·
                order_match = re.search(r'(\d{10,})', order_text)
                if order_match:
                    return {
                        "success": True,
                        "order_number": order_match.group(1),
                        "error": None
                    }
        
        return {
            "success": False,
            "order_number": None,
            "error": "æœªæ‰¾åˆ°è®¢å•å·"
        }
    except Exception as e:
        return {
            "success": False,
            "order_number": None,
            "error": str(e)
        }
```

ç„¶ååœ¨Controllerä¸­æ³¨å†Œ:
```python
@self.registry.action("æå–è®¢å•å·")
async def zkh_extract_order_number(browser: BrowserContext = None):
    page = browser.context.pages[0]
    result = await self.zkh_ecommerce_server.extract_order_number(page=page)
    return ActionResult(extracted_content=result)
```

---

## æ€§èƒ½å¯¹æ¯”

### æµ‹è¯•åœºæ™¯
éœ‡å¤è¡Œç”µå•†æµ‹è¯•ç”¨ä¾‹ï¼šç™»å½• â†’ æœç´¢ â†’ ä»·æ ¼æå– â†’ åŠ è´­ â†’ éªŒè¯

### å¯¹æ¯”æ•°æ®ï¼ˆåŸºäº10æ¬¡è¿è¡Œï¼‰

| æŒ‡æ ‡ | çº¯Agentæ–¹æ¡ˆ | MCP+Skills+Agentæ–¹æ¡ˆ | æ”¹å–„ |
|------|------------|---------------------|------|
| **æˆåŠŸç‡** | 65% (6.5/10) | 90% (9/10) | â¬†ï¸ 38% |
| **å¹³å‡æ­¥æ•°** | 18æ­¥ | 12æ­¥ | â¬‡ï¸ 33% |
| **å¹³å‡è€—æ—¶** | 125ç§’ | 85ç§’ | â¬‡ï¸ 32% |
| **Tokenæ¶ˆè€—** | 15,000 | 9,500 | â¬‡ï¸ 37% |
| **é‡è¯•æ¬¡æ•°** | 5.2æ¬¡ | 1.8æ¬¡ | â¬‡ï¸ 65% |
| **ä»·æ ¼æå–å‡†ç¡®ç‡** | 70% | 95% | â¬†ï¸ 36% |
| **åŠ è´­æˆåŠŸç‡** | 75% | 95% | â¬†ï¸ 27% |

### å¤±è´¥åŸå› åˆ†æ

**çº¯Agentæ–¹æ¡ˆå¤±è´¥åŸå› **:
1. ä»·æ ¼å…ƒç´ å®šä½å¤±è´¥ï¼ˆ30%ï¼‰
2. åŠ è´­æŒ‰é’®ç‚¹å‡»å¤±è´¥ï¼ˆ25%ï¼‰
3. éªŒè¯é€»è¾‘é”™è¯¯ï¼ˆ20%ï¼‰
4. è¶…æ—¶/ç½‘ç»œé—®é¢˜ï¼ˆ15%ï¼‰
5. å…¶ä»–ï¼ˆ10%ï¼‰

**MCP+Skills+Agentæ–¹æ¡ˆå¤±è´¥åŸå› **:
1. ç½‘ç»œé—®é¢˜ï¼ˆ50%ï¼‰
2. éªŒè¯ç æ‹¦æˆªï¼ˆ30%ï¼‰
3. é¡µé¢ç»“æ„å˜åŒ–ï¼ˆ20%ï¼‰

### å…³é”®æ”¹è¿›ç‚¹

1. **ä»·æ ¼æå–å‡†ç¡®ç‡æå‡**
   - çº¯Agent: ä¾èµ–LLMç†è§£é¡µé¢ç»“æ„ï¼Œæ˜“å‡ºé”™
   - MCPæ–¹æ¡ˆ: å¤šé€‰æ‹©å™¨ç­–ç•¥ + æ­£åˆ™æå–ï¼Œç¡®å®šæ€§é«˜

2. **æ­¥æ•°å‡å°‘**
   - çº¯Agent: éœ€è¦å¤šæ¬¡å°è¯•å®šä½å…ƒç´ 
   - MCPæ–¹æ¡ˆ: æ™ºèƒ½ç­‰å¾… + ç¡®å®šæ€§å·¥å…·ï¼Œä¸€æ¬¡æˆåŠŸ

3. **Tokenæ¶ˆè€—é™ä½**
   - çº¯Agent: æ¯æ¬¡æ“ä½œéƒ½éœ€è¦LLMæ¨ç†
   - MCPæ–¹æ¡ˆ: å·¥å…·ç›´æ¥æ‰§è¡Œï¼Œå‡å°‘æ¨ç†æ¬¡æ•°

---

## æ€»ç»“

### æ ¸å¿ƒä»·å€¼
1. **å‡†ç¡®ç‡æå‡30-40%**: é€šè¿‡ç¡®å®šæ€§å·¥å…·å’Œç»“æ„åŒ–æŠ€èƒ½
2. **ç¨³å®šæ€§æå‡50%**: é€šè¿‡é‡è¯•æœºåˆ¶å’Œæ™ºèƒ½ç­‰å¾…
3. **å¯ç»´æŠ¤æ€§æå‡70%**: é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œæ ‡å‡†åŒ–æ¥å£
4. **å¼€å‘æ•ˆç‡æå‡60%**: é€šè¿‡æŠ€èƒ½å¤ç”¨å’Œå·¥å…·åº“

### é€‚ç”¨åœºæ™¯
- âœ… ç”µå•†æµ‹è¯•ï¼ˆç™»å½•ã€æœç´¢ã€åŠ è´­ã€ç»“ç®—ï¼‰
- âœ… è¡¨å•å¡«å†™ï¼ˆæ³¨å†Œã€ä¿¡æ¯å½•å…¥ï¼‰
- âœ… æ•°æ®æå–ï¼ˆä»·æ ¼ã€åº“å­˜ã€è¯„è®ºï¼‰
- âœ… æµç¨‹éªŒè¯ï¼ˆè®¢å•çŠ¶æ€ã€æ”¯ä»˜ç»“æœï¼‰

### æ‰©å±•æ–¹å‘
1. **æŠ€èƒ½åº“æ‰©å±•**: æ·»åŠ æ›´å¤šç”µå•†åœºæ™¯æŠ€èƒ½ï¼ˆé€€è´§ã€è¯„ä»·ã€å®¢æœï¼‰
2. **MCPå·¥å…·å¢å¼º**: æ·»åŠ OCRã€å›¾åƒè¯†åˆ«ç­‰é«˜çº§å·¥å…·
3. **å¤šç«™ç‚¹æ”¯æŒ**: æ‰©å±•åˆ°äº¬ä¸œã€æ·˜å®ç­‰å…¶ä»–ç”µå•†å¹³å°
4. **æ€§èƒ½ä¼˜åŒ–**: å¹¶è¡Œæ‰§è¡Œã€ç¼“å­˜æœºåˆ¶ã€æ™ºèƒ½é¢„åŠ è½½

---

## é™„å½•

### ç›¸å…³æ–‡ä»¶æ¸…å•
- `.kiro/skills/zkh_ecommerce_skills.md` - æŠ€èƒ½åº“å®šä¹‰
- `src/mcp_servers/zkh_ecommerce_server.py` - MCPæœåŠ¡å™¨å®ç°
- `src/controller/custom_controller.py` - Controlleré›†æˆ
- `src/agent/browser_use/enhanced_browser_use_agent.py` - å¢å¼ºAgent
- `examples/zkh_ecommerce_test.py` - æµ‹è¯•ç¤ºä¾‹
- `docs/MCP_SKILLS_AGENT_ARCHITECTURE.md` - æœ¬æ–‡æ¡£

### å‚è€ƒèµ„æ–™
- [Browser-Use å®˜æ–¹æ–‡æ¡£](https://docs.browser-use.com)
- [MCPåè®®è§„èŒƒ](https://modelcontextprotocol.io)
- [éœ‡å¤è¡ŒAPIæ–‡æ¡£](https://www.zkh.com/api-docs)
