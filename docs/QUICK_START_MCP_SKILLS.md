# MCP+Skills+Agent å¿«é€Ÿå…¥é—¨æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

### å‰ç½®æ¡ä»¶
- Python 3.11+
- å·²å®‰è£…é¡¹ç›®ä¾èµ– (`pip install -r requirements.txt`)
- å·²é…ç½®éœ‡å¤è¡ŒAPI Key (`.env`æ–‡ä»¶ä¸­è®¾ç½®`ZKH_API_KEY`)

### æ–¹å¼1: è¿è¡Œç¤ºä¾‹è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# ç›´æ¥è¿è¡Œéœ‡å¤è¡Œç”µå•†æµ‹è¯•ç¤ºä¾‹
python examples/zkh_ecommerce_test.py
```

**é¢„æœŸè¾“å‡º**:
```
================================================================================
ğŸ§ª æµ‹è¯•ç”¨ä¾‹: éœ‡å¤è¡Œå•†å“æœç´¢åŠ è´­æµ‹è¯•
ğŸ”— ç›®æ ‡ç½‘ç«™: https://www.zkh.com
ğŸ” æœç´¢å…³é”®è¯: AIGO/çˆ±å›½è€… é¼ æ ‡ Q710 é»‘è‰²
ğŸ’° æœŸæœ›æœªç¨ä»·: 18.5
================================================================================
ğŸ¤– åˆå§‹åŒ–éœ‡å¤è¡Œå¤§æ¨¡å‹...
ğŸŒ åˆå§‹åŒ–æµè§ˆå™¨...
ğŸ› ï¸ åˆå§‹åŒ–Controllerï¼ˆé›†æˆMCPå·¥å…·ï¼‰...
ğŸš€ åˆå§‹åŒ–Enhanced Agentï¼ˆé›†æˆSkillsï¼‰...
â–¶ï¸ å¼€å§‹æ‰§è¡Œæµ‹è¯•...
============================================================
ğŸš€ Enhanced Browser Use Agent å¼€å§‹æ‰§è¡Œ
ğŸ“‹ ä»»åŠ¡: [ä»»åŠ¡è¯¦æƒ…]
ğŸ¯ æœ€å¤§æ­¥æ•°: 30
ğŸ› ï¸ å·²åŠ è½½éœ‡å¤è¡Œç”µå•†æŠ€èƒ½åº“å’ŒMCPå·¥å…·
============================================================
[æ‰§è¡Œè¿‡ç¨‹...]
============================================================
ğŸ“Š æ‰§è¡Œæ‘˜è¦
çŠ¶æ€: SUCCESS
æ­¥æ•°: 12/30
è€—æ—¶: 85.3s
Token: 9500
é‡è¯•: ç³»ç»Ÿçº§1 + ä¸šåŠ¡çº§0
============================================================
âœ… æµ‹è¯•é€šè¿‡ï¼
```

### æ–¹å¼2: åœ¨WebUIä¸­ä½¿ç”¨

1. **å¯åŠ¨WebUI**:
```bash
python webui.py --ip 127.0.0.1 --port 7788
```

2. **æ‰“å¼€æµè§ˆå™¨è®¿é—®**: `http://127.0.0.1:7788`

3. **åœ¨"Run Agent"æ ‡ç­¾é¡µè¾“å…¥ä»»åŠ¡**:
```
æ‰“å¼€éœ‡å¤è¡Œå®˜ç½‘zkh.comï¼Œç”¨è´¦å·18614277918ï¼Œå¯†ç test.123ç™»å½•,
æœç´¢"AIGO/çˆ±å›½è€… é¼ æ ‡ Q710 é»‘è‰² 1ä¸ª" æ‰¾åˆ°æœªç¨ä»·æ ¼å¹¶åŠ è´­ï¼Œ
åˆ¤æ–­æœªç¨ä»·æ ¼æ˜¯å¦æ˜¯18.50ï¼ŒåŠ è´­æ˜¯å¦æˆåŠŸã€‚
```

4. **ç‚¹å‡»"Run Agent"æŒ‰é’®**ï¼Œè§‚å¯Ÿæ‰§è¡Œè¿‡ç¨‹

---

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### 1. Skillsï¼ˆæŠ€èƒ½ï¼‰
**ä½ç½®**: `.kiro/skills/zkh_ecommerce_skills.md`

æŠ€èƒ½æ˜¯å¯¹å¸¸è§æ“ä½œçš„ç»“æ„åŒ–å°è£…ï¼ŒåŒ…å«ï¼š
- ç›®æ ‡æè¿°
- è¾“å…¥å‚æ•°
- æ‰§è¡Œæ­¥éª¤
- æˆåŠŸæ ‡å‡†
- å¤±è´¥å¤„ç†

**ç¤ºä¾‹**:
```markdown
### zkh_login_skill - ç™»å½•æŠ€èƒ½
**ç›®æ ‡**ï¼šå®Œæˆéœ‡å¤è¡Œç½‘ç«™ç™»å½•
**è¾“å…¥å‚æ•°**ï¼š
- username: ç”¨æˆ·å/æ‰‹æœºå·
- password: å¯†ç 

**æ‰§è¡Œæ­¥éª¤**ï¼š
1. å¯¼èˆªåˆ° zkh.com
2. ç‚¹å‡»ç™»å½•æŒ‰é’®
3. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
4. æäº¤ç™»å½•
5. éªŒè¯ç™»å½•çŠ¶æ€
```

### 2. MCP Toolsï¼ˆå·¥å…·ï¼‰
**ä½ç½®**: `src/mcp_servers/zkh_ecommerce_server.py`

MCPå·¥å…·æä¾›ç¡®å®šæ€§çš„èƒ½åŠ›ï¼Œå¦‚ï¼š
- `zkh_extract_price`: æ™ºèƒ½ä»·æ ¼æå–
- `zkh_verify_cart_status`: è´­ç‰©è½¦éªŒè¯
- `zkh_wait_for_element`: æ™ºèƒ½ç­‰å¾…
- `zkh_capture_network`: ç½‘ç»œæ•è·

**ç‰¹ç‚¹**:
- ç¡®å®šæ€§æ‰§è¡Œï¼ˆä¸ä¾èµ–LLMæ¨ç†ï¼‰
- å¤šç­–ç•¥å®¹é”™ï¼ˆå¦‚ä»·æ ¼æå–æ”¯æŒå¤šç§é€‰æ‹©å™¨ï¼‰
- è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼ˆä¾¿äºè°ƒè¯•ï¼‰

### 3. Agentï¼ˆä»£ç†ï¼‰
**ä½ç½®**: `src/agent/browser_use/enhanced_browser_use_agent.py`

Agentè´Ÿè´£ï¼š
- ä»»åŠ¡åˆ†è§£ï¼ˆå°†å¤æ‚ä»»åŠ¡æ‹†è§£ä¸ºæŠ€èƒ½åºåˆ—ï¼‰
- æŠ€èƒ½ç¼–æ’ï¼ˆæŒ‰ä¾èµ–å…³ç³»è°ƒåº¦æ‰§è¡Œï¼‰
- å¼‚å¸¸å¤„ç†ï¼ˆå¤±è´¥é‡è¯•ã€äººå·¥ä»‹å…¥ï¼‰
- æ‰§è¡Œç›‘æ§ï¼ˆæ­¥æ•°ã€Tokenã€é‡è¯•ç»Ÿè®¡ï¼‰

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: ç”µå•†å•†å“æµ‹è¯•
```python
task = """
ä½¿ç”¨ zkh_login_skill ç™»å½•éœ‡å¤è¡Œ
ä½¿ç”¨ zkh_search_skill æœç´¢"AIGOé¼ æ ‡"
ä½¿ç”¨ zkh_extract_price æå–æœªç¨ä»·æ ¼
ä½¿ç”¨ zkh_add_to_cart_skill åŠ è´­å•†å“
ä½¿ç”¨ zkh_verify_skill éªŒè¯ä»·æ ¼å’ŒåŠ è´­çŠ¶æ€
"""
```

### åœºæ™¯2: ä»·æ ¼ç›‘æ§
```python
task = """
æ‰“å¼€éœ‡å¤è¡Œå•†å“é¡µé¢
ä½¿ç”¨ zkh_extract_price æå–å½“å‰ä»·æ ¼
ä¸å†å²ä»·æ ¼å¯¹æ¯”
å¦‚æœä»·æ ¼ä¸‹é™ï¼Œå‘é€é€šçŸ¥
"""
```

### åœºæ™¯3: æ‰¹é‡åŠ è´­
```python
task = """
è¯»å–å•†å“æ¸…å•
å¯¹æ¯ä¸ªå•†å“ï¼š
  - ä½¿ç”¨ zkh_search_skill æœç´¢
  - ä½¿ç”¨ zkh_add_to_cart_skill åŠ è´­
ä½¿ç”¨ zkh_verify_cart_status éªŒè¯æ€»æ•°é‡
"""
```

---

## ğŸ› ï¸ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ æ–°æŠ€èƒ½

1. **ç¼–è¾‘æŠ€èƒ½åº“æ–‡ä»¶**: `.kiro/skills/zkh_ecommerce_skills.md`

```markdown
### 7. zkh_compare_price_skill - ä»·æ ¼å¯¹æ¯”æŠ€èƒ½
**ç›®æ ‡**ï¼šå¯¹æ¯”å¤šä¸ªå•†å“çš„ä»·æ ¼
**è¾“å…¥å‚æ•°**ï¼š
- product_list: å•†å“åˆ—è¡¨

**æ‰§è¡Œæ­¥éª¤**ï¼š
1. éå†å•†å“åˆ—è¡¨
2. å¯¹æ¯ä¸ªå•†å“ä½¿ç”¨ zkh_search_skill æœç´¢
3. ä½¿ç”¨ zkh_extract_price æå–ä»·æ ¼
4. æ±‡æ€»ä»·æ ¼ä¿¡æ¯
5. è¿”å›ä»·æ ¼å¯¹æ¯”ç»“æœ

**æˆåŠŸæ ‡å‡†**ï¼š
- æ‰€æœ‰å•†å“ä»·æ ¼æå–æˆåŠŸ
- è¿”å›æ ¼å¼åŒ–çš„å¯¹æ¯”è¡¨æ ¼
```

2. **åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨**:
```python
task = """
ä½¿ç”¨ zkh_compare_price_skill å¯¹æ¯”ä»¥ä¸‹å•†å“ä»·æ ¼ï¼š
- AIGOé¼ æ ‡ Q710
- ç½—æŠ€é¼ æ ‡ M185
- é›·è›‡é¼ æ ‡ V2
"""
```

### æ·»åŠ æ–°MCPå·¥å…·

1. **ç¼–è¾‘MCPæœåŠ¡å™¨**: `src/mcp_servers/zkh_ecommerce_server.py`

```python
async def extract_stock(
    self,
    page: Page
) -> Dict[str, Any]:
    """æå–åº“å­˜ä¿¡æ¯"""
    try:
        selectors = [
            ".stock-count",
            "[class*='stock']",
            "text=/åº“å­˜/",
        ]
        
        for sel in selectors:
            element = await page.wait_for_selector(sel, timeout=3000)
            if element:
                stock_text = await element.inner_text()
                stock_match = re.search(r'(\d+)', stock_text)
                if stock_match:
                    return {
                        "success": True,
                        "stock": int(stock_match.group(1)),
                        "error": None
                    }
        
        return {
            "success": False,
            "stock": None,
            "error": "æœªæ‰¾åˆ°åº“å­˜ä¿¡æ¯"
        }
    except Exception as e:
        return {
            "success": False,
            "stock": None,
            "error": str(e)
        }
```

2. **åœ¨Controllerä¸­æ³¨å†Œ**: `src/controller/custom_controller.py`

```python
@self.registry.action("æå–å•†å“åº“å­˜ä¿¡æ¯")
async def zkh_extract_stock(browser: BrowserContext = None):
    page = browser.context.pages[0]
    result = await self.zkh_ecommerce_server.extract_stock(page=page)
    if result["success"]:
        return ActionResult(
            extracted_content=f"åº“å­˜: {result['stock']}",
            include_in_memory=True
        )
    else:
        return ActionResult(error=result["error"])
```

3. **åœ¨æŠ€èƒ½ä¸­ä½¿ç”¨**:
```markdown
### zkh_check_stock_skill - åº“å­˜æ£€æŸ¥æŠ€èƒ½
**æ‰§è¡Œæ­¥éª¤**ï¼š
1. æœç´¢å•†å“
2. ä½¿ç”¨ zkh_extract_stock æå–åº“å­˜
3. åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æŠ€èƒ½åŠ è½½æƒ…å†µ
```python
# åœ¨ EnhancedBrowserUseAgent åˆå§‹åŒ–æ—¶ä¼šè¾“å‡º
# "EnhancedBrowserUseAgent initialized with skills integration"
# "Loaded skills from .kiro/skills/zkh_ecommerce_skills.md"
```

### 2. æŸ¥çœ‹MCPå·¥å…·æ³¨å†Œæƒ…å†µ
```python
# åœ¨ CustomController åˆå§‹åŒ–æ—¶ä¼šè¾“å‡º
# "å†…ç½®MCPå·¥å…·å·²æ³¨å†Œ: zkh_extract_price, zkh_verify_cart_status, ..."
```

### 3. ä½¿ç”¨ç½‘ç»œæ•è·å·¥å…·
```python
task = """
æ‰§è¡ŒåŠ è´­æ“ä½œ
å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨ zkh_capture_network æ•è·ç½‘ç»œè¯·æ±‚
åˆ†æå¤±è´¥åŸå› 
"""
```

### 4. æŸ¥çœ‹æ‰§è¡Œç›‘æ§æŒ‡æ ‡
```python
# æ‰§è¡Œå®Œæˆåä¼šè¾“å‡ºæ‰§è¡Œæ‘˜è¦
# åŒ…å«: çŠ¶æ€ã€æ­¥æ•°ã€è€—æ—¶ã€Tokenã€é‡è¯•æ¬¡æ•°
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: æŠ€èƒ½åº“æ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ
**A**: æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼š`.kiro/skills/zkh_ecommerce_skills.md`

### Q2: MCPå·¥å…·è°ƒç”¨å¤±è´¥ï¼Ÿ
**A**: æ£€æŸ¥Controlleræ˜¯å¦æ­£ç¡®åˆå§‹åŒ–ï¼š
```python
controller = CustomController()  # ä¼šè‡ªåŠ¨æ³¨å†ŒMCPå·¥å…·
```

### Q3: ä»·æ ¼æå–ä¸å‡†ç¡®ï¼Ÿ
**A**: å¯ä»¥è‡ªå®šä¹‰é€‰æ‹©å™¨ï¼š
```python
# åœ¨ä»»åŠ¡ä¸­æŒ‡å®š
"ä½¿ç”¨ zkh_extract_price å·¥å…·ï¼Œé€‰æ‹©å™¨ä¸º '.custom-price-class'"
```

### Q4: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Ÿ
**A**: è®¾ç½®æ—¥å¿—çº§åˆ«ï¼š
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### Q5: å¦‚ä½•å¤„ç†éªŒè¯ç ï¼Ÿ
**A**: æŠ€èƒ½åº“å·²åŒ…å«å¤„ç†ç­–ç•¥ï¼š
```markdown
**å¤±è´¥å¤„ç†**ï¼š
- å¦‚æœå‡ºç°éªŒè¯ç ï¼Œä½¿ç”¨ ask_for_assistant è¯·æ±‚äººå·¥ååŠ©
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | çº¯Agent | MCP+Skills+Agent | æå‡ |
|------|---------|------------------|------|
| æˆåŠŸç‡ | 65% | 90% | â¬†ï¸ 38% |
| å¹³å‡æ­¥æ•° | 18æ­¥ | 12æ­¥ | â¬‡ï¸ 33% |
| å¹³å‡è€—æ—¶ | 125ç§’ | 85ç§’ | â¬‡ï¸ 32% |
| Tokenæ¶ˆè€— | 15,000 | 9,500 | â¬‡ï¸ 37% |

---

## ğŸ“– è¿›é˜¶é˜…è¯»

- [å®Œæ•´æ¶æ„æ–‡æ¡£](./MCP_SKILLS_AGENT_ARCHITECTURE.md)
- [æŠ€èƒ½åº“è¯¦ç»†è¯´æ˜](./.kiro/skills/zkh_ecommerce_skills.md)
- [MCPæœåŠ¡å™¨å®ç°](../src/mcp_servers/zkh_ecommerce_server.py)
- [æµ‹è¯•ç¤ºä¾‹ä»£ç ](../examples/zkh_ecommerce_test.py)

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

ç°åœ¨ä½ å·²ç»äº†è§£äº†MCP+Skills+Agentæ–¹æ¡ˆçš„åŸºç¡€çŸ¥è¯†ï¼Œå¯ä»¥ï¼š

1. âœ… è¿è¡Œç¤ºä¾‹æµ‹è¯•ä½“éªŒæ•ˆæœ
2. âœ… åœ¨WebUIä¸­å°è¯•è‡ªå·±çš„ä»»åŠ¡
3. âœ… æ·»åŠ è‡ªå®šä¹‰æŠ€èƒ½å’Œå·¥å…·
4. âœ… æŸ¥çœ‹è¯¦ç»†æ¶æ„æ–‡æ¡£æ·±å…¥å­¦ä¹ 

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
